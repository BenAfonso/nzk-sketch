{"version":3,"file":"nzk-sketch.min.js","sources":["../src/nzk-sketch-stroke-model.js","../src/nzk-sketch-model.js","../src/nzk-sketch.js"],"sourcesContent":["export default class NzkSketchStrokeModel {\n  constructor(style, firstPoint) {\n    this.style = style\n\n    this.points = []\n\n    if (firstPoint) {\n      this.points.push({\n        s: firstPoint,\n        h: null\n      })\n    }\n  }\n\n  length() {\n    return this.points.length\n  }\n\n  lastPoint() {\n    return this.points[this.points.length - 1].s\n  }\n\n  addPoint(newPoint) {\n    this.points[this.points.length - 1].h = {\n      x: (this.points[this.points.length - 1].s.x + newPoint.x) / 2,\n      y: (this.points[this.points.length - 1].s.y + newPoint.y) / 2\n    }\n    return this.points.push({\n      s: newPoint,\n      h: null\n    })\n  }\n\n  serialize() {\n    return {\n      points: this.points,\n      style: this.style\n    }\n  }\n\n  deserialize (serialized) {\n    this.style = serialized.style\n    this.points = serialized.points || []\n  }\n}\n","\nimport NZKSketchStrokeModel from './nzk-sketch-stroke-model'\n\nexport default class NzkSketchModel {\n  constructor() {\n    this.colour = [0, 0, 0]\n    this.opacity = 1.0\n    this.size = 10\n    this.scale = window.devicePixelRatio >= 1.5 ? 2 : 1\n    this.actions = []\n    this.lastActionIndex = -1\n    this.currentStroke = null\n  }\n\n  sizeScaled() {\n    return this.size * this.scale\n  }\n\n  generateStyleKey() {\n    return `${this.opacity === 1.0 ? 'opaque' : 'transparent'}${this.eraser ? 'Eraser' : 'Colour'}${this.fill ? 'Fill' : 'Stroke'}`\n  }\n\n  getStyle() {\n    return {\n      opacity: this.opacity,\n      colour: this.colour,\n      size: this.sizeScaled(),\n      key: this.generateStyleKey()\n    }\n  }\n\n  initStroke(newPoint) {\n    if(this.canRedo()){\n      if(this.lastActionIndex === -1){\n        this.actions = []\n      } else {\n        this.actions = this.actions.slice(0, +this.lastActionIndex + 1 || 9e9)\n      }\n    }\n\n    this.currentStroke = new NZKSketchStrokeModel(this.getStyle(), newPoint)\n  }\n\n  continueStroke(newPoint) {\n    this.currentStroke.addPoint(newPoint)\n  }\n\n\tsaveStroke() {\n    this.actions.push({type: 'stroke', object: this.currentStroke})\n    this.currentStroke = null\n    this.lastActionIndex++\n  }\n\n  canUndo() {\n    return this.lastActionIndex > -1\n  }\n\n  canRedo() {\n    return this.lastActionIndex < this.actions.length - 1\n  }\n\n  reset() {\n    this.actions = []\n    this.lastActionIndex = -1\n    return this.currentStroke = null\n  }\n\n  serialize(){\n    let serialized = {\n      colour: this.colour,\n      opacity: this.opacity,\n      size: this.size,\n      scale: this.scale,\n      lastActionIndex: this.lastActionIndex\n    }\n\n    serialized.actions = []\n\n    this.actions.forEach(action => {\n      if(action.type === 'stroke'){\n        serialized.actions.push(\n          action.object.serialize()\n        )\n      }\n    })\n\n    if (this.currentStroke) {\n      serialized.currentStroke = this.currentStroke.serialize()\n    }\n\n    return serialized;\n  }\n\n  deserialize(serialized = {}) {\n    if(serialized.colour) {\n      this.colour = serialized.colour\n    }\n    if(serialized.opacity) {\n      this.opacity = serialized.opacity\n    }\n    if(serialized.size) {\n      this.size = serialized.size\n    }\n    if(serialized.scale) {\n      this.scale = serialized.scale\n    }\n    if(serialized.lastActionIndex){\n      this.lastActionIndex = serialized.lastActionIndex\n    }\n    if(serialized.actions){\n      this.actions = []\n\n      serialized.actions.forEach(action => {\n        if(action.type === 'stroke'){\n          let stroke = new NZKSketchStrokeModel()\n          stroke.deserialize(action.object)\n          action.stroke = stroke\n        }\n        this.actions.push(action)\n      })\n    }\n    if(serialized.currentStroke){\n      this.currentStroke = new NZKSketchStrokeModel()\n      this.currentStroke.deserialize(serialized.currentStroke)\n    }\n  }\n}","import NZKSketchModel from './nzk-sketch-model'\n\nexport default class NZKSketch {\n  constructor(props = {}) {\n    if(!props.containerEl){\n      throw new Error(\"NZKSketch requires a containerEl property\")\n    }\n    if(!props.width && props.height){\n      throw new Error(\"NZKSketch requires fixed width and height properties\")\n    }\n\n    this.containerEl = props.containerEl\n\n    this.template = props.template\n    this.isDrawing = false\n    \n    this.scale = window.devicePixelRatio >= 1.5 ? 2 : 1\n    this.width = props.width\n    this.height = props.height\n    this.widthScaled = this.width * this.scale\n\t\tthis.heightScaled = this.height * this.scale\n    \n    this.model = new NZKSketchModel()\n    this.model.eraser = false\n    this.model.opacity = 1\n\n    this.initDrawingCanvas()\n    this.initBufferCanvas()\n    this.initCacheCanvas()\n    this.initTouchLayer()\n    this.initDrawAnimations()\n    \n    this.setDrawingStyle(this.model.getStyle(), this.bufferCanvasCtx)\n  }\n\n  setBrushColour(colour = [0,0,0]) {\n    this.model.eraser = false\n    this.model.colour = colour\n  }\n\n  setBrushSize(size = 12) {\n    this.model.size = size\n  }\n\n  selectEraser() {\n    this.model.eraser = true\n  }\n\n  setCanvasSize(canvas){\n    canvas.width = this.widthScaled\n    canvas.height = this.heightScaled\n  }\n\n  setLayerStyle(el){\n    el.style.width = `${this.width}px`\n    el.style.height = `${this.height}px`\n    el.style.position = 'absolute'\n    el.style.left = '0px'\n    el.style.top = '0px'\n  }\n\n  initDrawingCanvas() {\n    this.drawingCanvas = document.createElement('canvas')\n    this.drawingCanvasCtx = this.drawingCanvas.getContext('2d')\n    this.setCanvasSize(this.drawingCanvas)\n    this.setLayerStyle(this.drawingCanvas)\n    this.drawingCanvas.style.zIndex = 1\n    this.containerEl.appendChild(this.drawingCanvas)\n  }\n\n  initBufferCanvas() {\n    this.bufferCanvas = document.createElement('canvas')\n    this.bufferCanvasCtx = this.drawingCanvas.getContext('2d')\n    this.setCanvasSize(this.bufferCanvas)\n    this.setLayerStyle(this.bufferCanvas)\n    this.bufferCanvas.style.zIndex = 2\n    this.containerEl.appendChild(this.bufferCanvas)\n  }\n\n  initCacheCanvas() {\n    this.cacheCanvas = document.createElement('canvas')\n    this.cacheCanvasCtx = this.cacheCanvas.getContext('2d')\n    this.setCanvasSize(this.cacheCanvas)\n    this.setLayerStyle(this.cacheCanvas)\n    this.cacheCanvas.style.display = 'none'\n    this.containerEl.appendChild(this.cacheCanvas)\n  }\n\n  initTouchLayer() {\n    this.touchLayerEl = document.createElement('div')\n    this.setLayerStyle(this.touchLayerEl)\n    this.touchLayerEl.style.zIndex = 3\n\n    this.onStartMouseDraw = this.onStartMouseDraw.bind(this)\n    this.onMoveMouseDraw = this.onMoveMouseDraw.bind(this)\n    this.onEndMouseDraw = this.onEndMouseDraw.bind(this)\n\n    this.touchLayerEl.addEventListener(\"mousedown\", this.onStartMouseDraw, false)\n    this.touchLayerEl.addEventListener(\"mousemove\", this.onMoveMouseDraw, false)\n    this.touchLayerEl.addEventListener(\"mouseup\", this.onEndMouseDraw, false)\n    this.touchLayerEl.addEventListener(\"mouseleave\", this.onEndMouseDraw, false)\n    this.touchLayerEl.addEventListener(\"mouseenter\", (ev) => {\n      if (ev.buttons > 0) {\n        this.onStartMouseDraw(ev)\n      }\n    }, false)\n\n    this.onStartTouchDraw = this.onStartTouchDraw.bind(this)\n    this.onMoveTouchDraw = this.onMoveTouchDraw.bind(this)\n    this.onEndTouchDraw = this.onEndTouchDraw.bind(this)\n\n    this.touchLayerEl.addEventListener(\"touchstart\", this.onStartTouchDraw, false)\n    this.touchLayerEl.addEventListener(\"touchmove\", this.onMoveTouchDraw, false)\n    this.touchLayerEl.addEventListener(\"touchend\", this.onEndTouchDraw, false)\n\n    this.containerEl.appendChild(this.touchLayerEl)\n  }\n\n  initDrawAnimations(){\n    this.drawUndo = {\n\t\t\ttransparentEraserFill: this.drawTransparentFillFinal,\n\t\t\ttransparentEraserStroke: this.drawStrokeFinal,\n\t\t\ttransparentColourFill: this.drawTransparentFillFinal,\n\t\t\ttransparentColourStroke: this.drawStrokeFinal,\n\t\t\topaqueEraserFill: this.drawEraserUndoingFillFinal,\n\t\t\topaqueEraserStroke: this.drawEraserUndoingFinal,\n\t\t\topaqueColourFill: this.drawFillFinal,\n      opaqueColourStroke: this.drawStrokeFinal\n    }\n\n\t\tthis.drawFinished = {\n\t\t\ttransparentEraserFill: this.drawTransparentFillFinal,\n\t\t\ttransparentEraserStroke: this.drawStrokeFinal,\n\t\t\ttransparentColourFill: this.drawTransparentFillFinal,\n\t\t\ttransparentColourStroke: this.drawStrokeFinal,\n\t\t\topaqueEraserFill: this.drawEraserFillFinal,\n\t\t\topaqueEraserStroke: this.drawEraser,\n\t\t\topaqueColourFill: this.drawFillFinal,\n      opaqueColourStroke: this.drawStrokeFinal\n    }\n\n\t\tthis.drawAnimation = {\n\t\t\ttransparentEraserFill: this.drawFillAndStroke,\n\t\t\ttransparentEraserStroke: this.drawFillAndStroke,\n\t\t\ttransparentColourFill: this.drawFillAndStroke,\n\t\t\ttransparentColourStroke: this.drawFillAndStroke,\n\t\t\topaqueEraserFill: this.drawEraser,\n\t\t\topaqueEraserStroke: this.drawEraser,\n\t\t\topaqueColourFill: this.drawFillAndStroke,\n      opaqueColourStroke: this.drawFillAndStroke\n    }\n  }\n\n  getMousePoint (ev) {\n    let rect = this.touchLayerEl.getBoundingClientRect()\n\n    return {\n      x: (ev.clientX - rect.left) * this.scale,\n      y: (ev.clientY - rect.top) * this.scale\n    }\n  }\n\n  getTouchPoint (ev) {\n    let rect = this.touchLayerEl.getBoundingClientRect()\n\n    return {\n      x: (ev.touches[0].clientX - rect.left) * this.scale,\n      y: (ev.touches[0].clientY - rect.top) * this.scale\n    }\n  }\n\n  onStartMouseDraw(ev) {\n    ev.preventDefault() // prevents scroll\n    this.startDraw(this.getMousePoint(ev))\n  }\n\n  onStartTouchDraw(ev) {\n    ev.preventDefault() // prevents scroll\n    this.startDraw(this.getTouchPoint(ev))\n  }\n\n  onMoveMouseDraw(ev) {\n    this.continueDraw(this.getMousePoint(ev))\n  }\n\n  onMoveTouchDraw(ev) {\n    this.continueDraw(this.getTouchPoint(ev))\n  }\n\n  onEndMouseDraw(ev) {\n    this.endDraw(this.getMousePoint(ev))\n  }\n\n  onEndTouchDraw(ev) {\n    this.endDraw(this.getTouchPoint(ev))\n  }\n\n  startDraw(point) {\n    this.isDrawing = true\n    this.model.initStroke(point)\n    this.setDrawingStyle(this.model.currentStroke.style, this.bufferCanvasCtx)\n    this.strokeAnimation()\n  }\n\n  continueDraw(point) {\n    if(!this.isDrawing) return false\n    this.model.continueStroke(point)\n  }\n\n  endDraw(point) {\n    this.isDrawing = false\n    this.endStrokeAnimation() \n    this.bufferCanvasCtx.clearRect(0, 0, this.canvasWidthScaled, this.canvasHeightScaled)\n    this.drawFinishedStroke(this.model.currentStroke)\n    this.model.saveStroke()\n  }\n\n  setDrawingStyle (style, ctx) {\n\t\tlet colour = `rgba(${style.colour[0]}, ${style.colour[1]}, ${style.colour[2]}, ${style.opacity})`\n\t\tctx.strokeStyle = colour\n\t\tctx.fillStyle = colour\n\t\tctx.lineWidth = style.size\n\t\tctx.lineJoin = \"round\"\n    ctx.lineCap = \"round\"\n  }\n\n\tstrokeAnimation() {\n    this.drawAnimationStroke(this.model.currentStroke)\n\t\tthis.reqStroke = window.requestAnimationFrame(() => this.strokeAnimation.apply(this))\n  }\n\n\tdrawAnimationStroke(stroke) {\n    this.drawAnimation[stroke.style.key].apply(this, [stroke])\n  }\n\n\tendStrokeAnimation() {\n\t\twindow.cancelAnimationFrame(this.reqStroke)\n    this.reqStroke = 0\n  }\n\n  drawUndoStroke(stroke) {\n\t\tthis.setDrawingStyle(stroke.style, this.drawingCanvasCtx)\n    this.drawUndo[stroke.style.key].apply(this, [stroke])\n  }\n\n\tdrawFinishedStroke(stroke) {\n    if(!stroke) return\n\t\tthis.setDrawingStyle(stroke.style, this.drawingCanvasCtx)\n    this.drawFinished[stroke.style.key].apply(this, [stroke])\n  }\n\n\tdrawExistingStroke(stroke) {\n\t\tthis.setDrawingStyle(stroke.style, this.drawingCanvasCtx)\n    this.drawFinished[stroke.style.key].apply(this, [stroke, false])\n  }\n  \n  trace(stroke, ctx) {\n    let nbPoints = stroke.length()\n    \n    ctx.beginPath()\n    \n    if(nbPoints < 3) {\n      ctx.moveTo(stroke.points[0].s.x, stroke.points[0].s.y)\n      ctx.lineTo(stroke.points[nbPoints-1].s.x + 0.001, stroke.points[nbPoints-1].s.y + 0.001)\n    } else {\n      ctx.moveTo(stroke.points[0].s.x, stroke.points[0].s.y)\n      \n      var i, len, move, ref\n\n      ref = stroke.points.slice(1, +(nbPoints - 2) + 1 || 9e9)\n      for (i = 0, len = ref.length; i < len; i++) {\n        move = ref[i]\n        ctx.quadraticCurveTo(move.s.x, move.s.y, move.h.x, move.h.y)\n      }\n    }\n  }\n\n\tgetDrawingDataUrl(){\n    return this.drawingCanvas.toDataURL()\n  } \n\n\tdrawTransparentFillFinal(stroke) {\n\t\tthis.cacheCanvasCtx.clearRect(0, 0, this.canvasWidthScaled, this.canvasHeightScaled)\n    this.cacheCanvasCtx.globalCompositeOperation = \"source-over\"\n    stroke.style.opacity = stroke.style.opacity || 1\n\t\tthis.setDrawingStyle(stroke.style, this.cacheCanvasCtx)\n\t\tthis.trace(stroke, this.cacheCanvasCtx)\n\t\tthis.cacheCanvasCtx.closePath()\n\t\tthis.cacheCanvasCtx.fill()\n\t\tthis.cacheCanvasCtx.stroke()\n\n\t\tthis.drawingCanvasCtx.globalCompositeOperation = \"source-over\"\n\t\tthis.drawingCanvasCtx.globalAlpha = stroke.style.opacity\n\t\tthis.drawingCanvasCtx.drawImage(this.cacheCanvasCtx.canvas, 0, 0, this.canvasWidthScaled, this.canvasHeightScaled)\n    this.drawingCanvasCtx.globalAlpha = 1.0\n  }\n\n\tdrawStrokeFinal(stroke) {\n\t\tthis.drawingCanvasCtx.globalCompositeOperation = \"source-over\"\n\t\tthis.trace(stroke, this.drawingCanvasCtx)\n    this.drawingCanvasCtx.stroke()\n  }\n\n\tdrawFillFinal(stroke) {\n\t\tthis.drawingCanvasCtx.globalCompositeOperation = \"source-over\"\n\t\tthis.trace(stroke, this.drawingCanvasCtx)\n\t\tthis.drawingCanvasCtx.closePath()\n\t\tthis.drawingCanvasCtx.fill()\n    this.drawingCanvasCtx.stroke()\n  }\n\n\tdrawFillAndStroke(stroke) {\n\t\tthis.bufferCanvasCtx.clearRect(0, 0, this.canvasWidthScaled, this.canvasHeightScaled)\n\t\tthis.trace(stroke, this.bufferCanvasCtx)\n    this.bufferCanvasCtx.stroke()\n  }\n\n\tdrawEraserUndoingFinal(stroke) {\n\t\tthis.drawingCanvasCtx.globalCompositeOperation = \"destination-out\"\n\t\tthis.trace(stroke, this.drawingCanvasCtx)\n    this.drawingCanvasCtx.stroke()\n  }\n\n\tdrawEraserUndoingFillFinal(stroke) {\n\t\tthis.drawingCanvasCtx.globalCompositeOperation = \"destination-out\"\n\t\tthis.trace(stroke, this.drawingCanvasCtx)\n\t\tthis.drawingCanvasCtx.closePath()\n\t\tthis.drawingCanvasCtx.fill()\n    this.drawingCanvasCtx.stroke()\n  }\n\n\tdrawEraser(stroke, copy = true) {\n\t\tif(copy){\n\t\t\tthis.drawingCanvasCtx.globalCompositeOperation = \"copy\"\n      this.drawingCanvasCtx.drawImage(this.cacheCanvasCtx.canvas, 0, 0, this.canvasWidthScaled, this.canvasHeightScaled)\n    }\n\n\t\tthis.drawingCanvasCtx.globalCompositeOperation = \"destination-out\"\n\t\tthis.trace(stroke, this.drawingCanvasCtx)\n    this.drawingCanvasCtx.stroke()\n  }\n\n\tdrawEraserFillFinal(stroke, copy = true){\n\t\tif(copy) {\n\t\t\tthis.drawingCanvasCtx.globalCompositeOperation = \"copy\"\n      this.drawingCanvasCtx.drawImage(this.cacheCanvasCtx.canvas, 0, 0, this.canvasWidthScaled, this.canvasHeightScaled)\n    }\n\n\t\tthis.drawingCanvasCtx.globalCompositeOperation = \"destination-out\"\n\t\tthis.trace(stroke, this.drawingCanvasCtx)\n\t\tthis.drawingCanvasCtx.closePath()\n\t\tthis.drawingCanvasCtx.fill()\n    this.drawingCanvasCtx.stroke()\n  }\n}\n\n// \tundo: ->\n// \t\tif this.model.canUndo()\n// \t\t\tthis.model.latestActionIndex--\n\n// \t\t\tthis.drawingCanvasCtx.clearRect(0, 0, this.canvasWidthScaled, this.canvasHeightScaled)\n\n// \t\t\tthis.importImage()\n\n// \t\t\tif this.model.latestActionIndex > -1\n// \t\t\t\tq = queue(1)\n\n// \t\t\t\tfor action in this.model.actions[0..this.model.latestActionIndex]\n// \t\t\t\t\tdo (action) =>\n// \t\t\t\t\t\tif action.type is 'image'\n// \t\t\t\t\t\t\tq.defer (cb) =>\n// \t\t\t\t\t\t\t\tthis.drawImage(action.object, cb)\n// \t\t\t\t\t\telse\n// \t\t\t\t\t\t\tq.defer (cb) =>\n// \t\t\t\t\t\t\t\tthis.drawUndoStroke(action.object)\n// \t\t\t\t\t\t\t\tcb()\n\n// \t\t\tthis.trigger('change-drawing')\n\n// \t\t\treturn true\n\n// \tredo: ->\n// \t\tif this.model.canRedo()\n// \t\t\tthis.model.latestActionIndex++\n\n// \t\t\taction = this.model.actions[this.model.latestActionIndex]\n\n// \t\t\tif action.type is 'image'\n// \t\t\t\tthis.drawImage action.object, =>\n// \t\t\t\t\tthis.trigger('change-drawing')\n// \t\t\telse\n// \t\t\t\tthis.drawUndoStroke(action.object)\n// \t\t\t\tthis.trigger('change-drawing')\n\n// \trestart: ->\n// \t\tthis.model.reset()\n\n// \t\tthis.drawingCanvasCtx.clearRect(0, 0, this.canvasWidthScaled, this.canvasHeightScaled)\n\n// \t\tthis.trigger('change-drawing')\n\n// \t\tthis.importImage()\n"],"names":["NzkSketchStrokeModel","style","firstPoint","points","push","s","h","this","length","newPoint","x","y","serialized","NzkSketchModel","colour","opacity","size","scale","window","devicePixelRatio","actions","lastActionIndex","currentStroke","eraser","fill","sizeScaled","key","generateStyleKey","canRedo","slice","NZKSketchStrokeModel","getStyle","addPoint","type","object","forEach","action","serialize","stroke","deserialize","_this","props","containerEl","Error","width","height","template","isDrawing","widthScaled","heightScaled","model","NZKSketchModel","initDrawingCanvas","initBufferCanvas","initCacheCanvas","initTouchLayer","initDrawAnimations","setDrawingStyle","bufferCanvasCtx","canvas","el","position","left","top","drawingCanvas","document","createElement","drawingCanvasCtx","getContext","setCanvasSize","setLayerStyle","zIndex","appendChild","bufferCanvas","cacheCanvas","cacheCanvasCtx","display","touchLayerEl","onStartMouseDraw","bind","onMoveMouseDraw","onEndMouseDraw","addEventListener","ev","buttons","onStartTouchDraw","onMoveTouchDraw","onEndTouchDraw","drawUndo","transparentEraserFill","drawTransparentFillFinal","transparentEraserStroke","drawStrokeFinal","transparentColourFill","transparentColourStroke","opaqueEraserFill","drawEraserUndoingFillFinal","opaqueEraserStroke","drawEraserUndoingFinal","opaqueColourFill","drawFillFinal","opaqueColourStroke","drawFinished","drawEraserFillFinal","drawEraser","drawAnimation","drawFillAndStroke","rect","getBoundingClientRect","clientX","clientY","touches","preventDefault","startDraw","getMousePoint","getTouchPoint","continueDraw","endDraw","point","initStroke","strokeAnimation","continueStroke","endStrokeAnimation","clearRect","canvasWidthScaled","canvasHeightScaled","drawFinishedStroke","saveStroke","ctx","strokeStyle","fillStyle","lineWidth","lineJoin","lineCap","drawAnimationStroke","reqStroke","requestAnimationFrame","_this2","apply","cancelAnimationFrame","i","len","move","ref","nbPoints","beginPath","moveTo","lineTo","quadraticCurveTo","toDataURL","globalCompositeOperation","trace","closePath","globalAlpha","drawImage"],"mappings":"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"}